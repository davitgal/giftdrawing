<script>
    const button = document.getElementById("drawButton");
    const message = document.getElementById("message");

    button.addEventListener("click", () => {
        getNextPrize();
    });

    async function getNextPrize() {
        try {
            const response = await fetch('https://script.google.com/macros/s/AKfycbzX3nNF6wDZNv7ThVUVOtbLVeQrQ0bZBMIvw71qtVYFhDagER3u6Lzhhs2sG33UWJlV/exec');
            if (!response.ok) {
                throw new Error('Ошибка при получении данных');
            }
            const data = await response.json();

            if (data.prize) {
                message.textContent = `Поздравляем! Вы выиграли ${data.prize}`;
                updatePrizeStatus(data.rowIndex);
            } else {
                message.textContent = "Извините, все подарки уже розданы!";
            }
        } catch (error) {
            console.error('Ошибка:', error);
            message.textContent = 'Произошла ошибка при попытке получить данные.';
        }
    }

    async function updatePrizeStatus(rowIndex) {
        try {
            const formData = new URLSearchParams(); // Используем URLSearchParams вместо JSON
            formData.append('rowIndex', rowIndex);

            const response = await fetch('https://script.google.com/macros/s/AKfycbzX3nNF6wDZNv7ThVUVOtbLVeQrQ0bZBMIvw71qtVYFhDagER3u6Lzhhs2sG33UWJlV/exec', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Ошибка при обновлении статуса');
            }
            console.log('Статус обновлен успешно');
        } catch (error) {
            console.error('Ошибка при обновлении статуса:', error);
        }
    }
</script>
